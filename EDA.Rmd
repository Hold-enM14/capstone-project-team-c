---
title: "EDA"
output: html_document
date: "2025-11-14"
---

libraies
```{r}
library(dplyr)
library(lubridate)
```

Importing data
```{r}
weather = read.csv("data/weather-data.csv")
airquality = read.csv("data/air-quality-data.csv")
boston = read.csv("data/boston-marathon-data.csv")
chicago = read.csv("data/chicago-marathon-data.csv")
nyc = read.csv("data/nyc-marathon-data.csv")
berlin = read.csv("data/berlin-marathon-data.csv")
```

Taking a look at the datasets
```{r}
str(boston)
str(berlin)
str(nyc)
str(chicago)
str(weather)
str(airquality)
```

Standardize all the marathon datasets
```{r}
boston_clean <- boston %>%
  transmute(
    year = year,
    marathon = "Boston",
    gender = gender,
    chip_time = official_time
  )

berlin_clean <- berlin %>%
  transmute(
    year = YEAR,
    marathon = "Berlin",
    gender = GENDER,
    chip_time = TIME
  )

nyc_clean <- nyc %>%
  transmute(
    year = Year,
    marathon = "NYC",
    gender = Gender,
    chip_time = Finish.Time
  )

chicago_clean <- chicago %>%
  transmute(
    year = Year,
    marathon = "Chicago",
    gender = Gender,
    chip_time = Finish.Time
  )
```

Combine the marathon datasets
```{r}
# using bind_rows so we can row-wise combine and have data for each runner
marathons_all <- bind_rows(
  boston_clean,
  berlin_clean,
  nyc_clean,
  chicago_clean
)
```

```{r}
head(marathons_all)
```

Chip-Time Cleaning Function (pulled from chatgbt)
```{r}
clean_chip_time <- function(x) {
  
  # Convert numeric Excel-style times to character HH:MM:SS
  x_numeric <- suppressWarnings(as.numeric(x))
  is_fraction <- !is.na(x_numeric) & x_numeric < 1 & x_numeric > 0
  
  x[is_fraction] <- format(
    as.POSIXct("1970-01-01", tz = "UTC") + x_numeric[is_fraction] * 86400,
    "%H:%M:%S"
  )
  
  # Everything else treat as text and clean
  x <- as.character(x)
  x <- trimws(x)
  
  # Replace known invalid strings with NA
  invalid <- c("", "NA", "N/A", "—", "-", "DNF", "DNS", "DQ", "no time", "No Time", "NO TIME")
  x[x %in% invalid] <- NA
  
  # Pad missing zeros (H:MM:SS → HH:MM:SS, etc.)
  x <- gsub("^([0-9]):", "0\\1:", x)
  x <- gsub(":([0-9]):", ":0\\1:", x)
  x <- gsub(":([0-9])$", ":0\\1", x)
  
  return(x)
}

```

Clean chip_time
```{r}
marathons_all <- marathons_all %>%
  mutate(chip_time_clean = clean_chip_time(chip_time))
```

Convert the cleaned chip_time values to H:M:S, need chip_seconds to find the average finishing times
```{r}
marathons_all <- marathons_all %>%
  mutate(
    chip_seconds = suppressWarnings(period_to_seconds(hms(chip_time_clean)))
  )
```

```{r}
head(marathons_all)
```

Need to see what we want to do with these missing values and where they are comming from(this is where I left off)
```{r}
marathons_all %>% 
  summarize(missing_finish_times = sum(is.na(chip_seconds)))
```

Next we need to compute average finishing times, group by: year, marathon, gender, performance group (will probably add this later)

```{r}
avg_times <- marathons_all %>%
  group_by(year, marathon, gender) %>%
  summarise(avg_chip_seconds = mean(chip_seconds, na.rm = TRUE), .groups = "drop")

avg_times
```

**Looks like there is missing info for several years, and the gender column needs to be cleaned
